---
- name: Check if the old group exists      #check old group----
  win_command: net localgroup "{{ old_group_name }}"
  register: old_group_check
  ignore_errors: yes
- name: Set fact for old group existence
  set_fact:
    old_group_exists: "{{ old_group_check.rc == 0 }}"
- name: Check if this server should have the new group added
  set_fact:
     add_new_group: "{{ old_group_status[inventory_hostname] | default(false) }}"
- name: Add new group 
  win_command: net localgroup "{{ new_group_name }}" /add
  when: action_type == "Add"
  register: new_group_add
  changed_when: new_group_add.rc == 0
- name: check status on new group addition
  debug:
    msg: "new group "{{ new_group_name }}"  added successfully"
  when: new_group_add.changed
  
- name: Check if the new group exists
  win_command: net localgroup "{{ new_group_name }}"
  register: new_group_check
  
- name: Set fact based on new group existence status
  set_fact:
    new_group_exists: "{{ new_group_check.rc == 0 }}"
    
- name: Delete old group
  win_command: net localgroup "{{ old_group_name }}" /delete
  when: action_type == "delete"
  register: old_group_delete
  changed_when: old_group_delete.rc == 0
- name: check status on new group addition
  debug:
    msg: "Old group "{{ old_group_name }}" deleted successfully"
  when: old_group_delete.changed
